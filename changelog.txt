function updateSelectedLinks() {
      const links = document.querySelectorAll('a');
      const boxRect = selectionBox.getBoundingClientRect();
    
      links.forEach(link => {
        // Check if element is sticky
        if (isElementSticky(link)) {
            return;
        }

         // Add visibility checks
         const style = window.getComputedStyle(link);
         if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {
             return;
         }

         
      
        
         
          const rect = link.getBoundingClientRect();
          // Check if element is actually visible in viewport
          if (rect.width === 0 || rect.height === 0) {
            return;
        }

        // Check if any parent element makes this invisible
        let parent = link.parentElement;
        while (parent) {
            const parentStyle = window.getComputedStyle(parent);
            if (parentStyle.display === 'none' || parentStyle.visibility === 'hidden') {
                return;
            }
            parent = parent.parentElement;
        }
        // Check if link is within selection box
          const isInBox = !(rect.left > boxRect.right || 
                         rect.right < boxRect.left || 
                         rect.top > boxRect.bottom || 
                         rect.bottom < boxRect.top);
        
          if (isInBox) {
              selectedLinks.add(link);
              link.style.backgroundColor = `${currentMatchedAction.boxColor}33`;
          } else {
              selectedLinks.delete(link);
              link.style.backgroundColor = '';
          }
      });
  }

  //this update fixed zendesk issue that opened links in opened tickets not visible to user.add

  //old version:

  function updateSelectedLinks() {
    const links = document.querySelectorAll('a');
    const boxRect = selectionBox.getBoundingClientRect();
  
    links.forEach(link => {

      if (isElementSticky(link)) {
          return;
      }
        const rect = link.getBoundingClientRect();
        const isInBox = !(rect.left > boxRect.right || 
                       rect.right < boxRect.left || 
                       rect.top > boxRect.bottom || 
                       rect.bottom < boxRect.top);
      
        if (isInBox) {
            selectedLinks.add(link);
            link.style.backgroundColor = `${currentMatchedAction.boxColor}33`;
        } else {
            selectedLinks.delete(link);
            link.style.backgroundColor = '';
        }
    });
}